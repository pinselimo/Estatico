<!DOCTYPE HTML>
<!--
	Binary by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
 <head>
  <title>
   BEHAVIOUR dot space
  </title>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <link href="../../assets/css/main.css" media="screen, print" rel="stylesheet" type="text/css"/>
 </head>
 <body>
  <!-- Header -->
  <header id="header">
   <a class="logo" href="javascript:history.back()">
    <strong>
     BLOG
    </strong>
    space
   </a>
   <!-- <nav class="nav mobile">
                <a href="#menu">Menu</a>
            </nav> -->
   <nav class="nav">
    <ul class="actions">
     <li>
      <a class="scrolly" href="../blog_0.html">
       Home
      </a>
     </li>
     <li>
      <a href="javascript:history.back()">
       Back
      </a>
     </li>
    </ul>
   </nav>
  </header>
  <!-- Nav -->
  <!-- <nav id="menu">
				<ul class="links">
					<li><a href="index.html">Home</a></li>
				</ul>
			</nav> -->
  <!-- Main -->
  <section id="main">
   <div class="inner">
    <header>
     <h1>
      TerraTec Connect N3 Hack Part 2
     </h1>
     <p class="info">
      Opening doors, exploring the jungle
     </p>
    </header>
    <p>
     Having my UART stick connected to my computer I started screen to try out different bitrates, ending up at 115.200 bit/s which finally had me seeing meaningful ASCII on my screen and entering my home field: the software.
    </p>
    <p>
     <img alt="Boot screen" src="images/conn_2.jpg" width="500px"/>
    </p>
    <h3>
     Opening doors and finding keys aka the interesting part
    </h3>
    <p>
     The first output booting up we got was U-Boot booting up the linux based OS on, as i guessed, an Atheros chip. The exact model is strangely sometimes called a AR7241 (Virian) and sometimes its predecessor the AR7240 (Python).
     <br/>
     Luckily a one second windows to interrupt the booting process is offered to us:
    </p>
    <pre><code class="uboot">PB93 (ar7241 - Virian) U-boot
DRAM:
sri
ar7240_ddr_initial_config(133): virian ddr1 init
____________________________________________________

Hit any key to stop autoboot:  1  0
## Booting image at 9f300000 ...
   Image Name:   Linux Kernel Image
   Created:      2011-06-14  10:12:25 UTC
   Image Type:   MIPS Linux Kernel Image (lzma compressed)
   Data Size:    783960 Bytes = 765.6 kB
   Load Address: 80002000
   Entry Point:  80211000
   Verifying Checksum ... OK
   Uncompressing Kernel Image ... OK
No initrd
## Transferring control to Linux (at address 80211000) ...
## Giving linux memsize in bytes, 16777216

Starting kernel ...

Booting AR7240(Python)â€¦
</code></pre>
    <p>
     So I did, and ended up in the U-Boot boot manager. I looked at the environment variables set at boot time and changed them.
    </p>
    <p>
     Boot variables:
    </p>
    <pre><code class="bash">arg 4: init=/sbin/init
arg 6: virian # still strange thing going on with the processor generation
</code></pre>
    <p>
     Changing the boot variables to:
     <code>
      arg 4: init=/sbin/sh
     </code>
     <br/>
     had the kernel panic, so i tried:
     <code>
      arg 4: init=/bin/sh
     </code>
    </p>
    <p>
     Et voilÃ¡ we boot into the shell as root user:
    </p>
    <p>
     <img alt="Root" src="images/conn_4.jpg" width="500px"/>
    </p>
    <p>
     Unfortunately we also end up having a read only file system, so no password change via passwd but we can inspect the /etc/passwd and
     <code>
      /etc/shadow
     </code>
     file:
    </p>
    <p>
     <img alt="Passwd" src="images/conn_15.jpg" width="500px"/>
    </p>
    <p>
     As we can see, there are some users w/o password and the root and Admin user share root privileges and the same hash. As with many of these devices, googling the hash reveals the password behind it way too easy. So now we can boot up the device normally, using the init process and login as root having a r/w file system.
    </p>
    <h3>
     Exploring the jungle, looking for holes and bugs
    </h3>
    <p>
     The first question i faced was, which gen's processor this thing runs under the hood, hidden away under the shield:
    </p>
    <pre><code class="bash">system type             : Atheros AR7240 (Python)

#looks as if weâ€™re running the old version

processor               : 0

cpu model               : MIPS 24K V7.4
</code></pre>
    <p>
     Letâ€™s look at the processes running after startup, ps spits out:
    </p>
    <pre><code class="bash">217 root        124 S   /usr/sbin/telnetd
220 root         56 D   /bin/factoryreset /dev/freset
221 root        392 S   my_httpd
222 root        288 S   netusb_wd CONNECT N3
228 root        328 S   netusb br0 CONNECT
231 root        276 S   awdp br0 CONNECT
229 root            SW  [thread_func_ex]
240 root        184 S   /sbin/getty ttyS0 115200
245 root        184 S   udhcpc -b -i br0 -s /etc/udhcpc.script
285 root        372 S   -sh
314 root        188 R   ps
</code></pre>
    <p>
     Interesting to us are netusb and awdp, the last one of which i still donâ€™t know anything about, but netusb rings the alarm bells in every security enthusiastâ€™s mind, as there was a hole discovered in the software mid 2015 caused by a buffer overflow.
    </p>
    <p>
     NetUSB is a service, nomen est omen, providing USB over the local network. So it seems likely that it mirrors the USB DVB-S stick coming from the Cypress controller in the LAN, the driver on the clientâ€™s Windows machine then acts as an interface between a virtual USB device and the netusb device in the network.
    </p>
    <p>
     In the next post weâ€™ll look into whatâ€™s happening on the network!
    </p>
   </div>
  </section>
  <!-- Footer -->
  <footer id="footer">
   <ul class="icons">
    <li>
     <a class="fab fa-twitter fa-2x" href="https://twitter.com/pIakoIb" style="text-decoration: none">
     </a>
    </li>
    <li>
     <a class="fab fa-researchgate fa-2x" href="https://www.researchgate.net/profile/Simon_Plakolb" style="text-decoration: none">
     </a>
    </li>
    <li>
     <a class="fab fa-github fa-2x" href="https://github.com/pinselimo" style="text-decoration: none">
     </a>
    </li>
   </ul>
   <div class="copyright">
    <i class="fas fa-phone-alt">
     +43 (0)316 380 - 7347
    </i>
    <br/>
    <i class="fas fa-envelope">
     simon (dot) plakolb (at) uni (minus) graz (dot) at
    </i>
    <br/>
    <i class="fas fa-map-marker-alt">
     Merangasse 18, A-8010 Graz
    </i>
    <br/>
    © Simon Plakolb. License:
    <a href="http://creativecommons.org/licenses/by/3.0">
     CC-BY
    </a>
    . Template:
    <a href="https://templated.co">
     TEMPLATED
    </a>
    .
   </div>
  </footer>
  <!-- Scripts -->
  <script src="../../assets/js/jquery.min.js">
  </script>
  <script src="../../assets/js/jquery.scrolly.min.js">
  </script>
  <script src="../../assets/js/skel.min.js">
  </script>
  <script src="../../assets/js/util.js">
  </script>
  <script src="../../assets/js/main.js">
  </script>
 </body>
</html>