<!DOCTYPE HTML>
<!--
	Binary by TEMPLATED
	templated.co @templatedco
	Released for free under the Creative Commons Attribution 3.0 license (templated.co/license)
-->
<html>
 <head>
  <title>
   BEHAVIOUR dot space
  </title>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <link href="../../assets/css/main.css" media="screen, print" rel="stylesheet" type="text/css"/>
 </head>
 <body>
  <!-- Header -->
  <header id="header">
   <a class="logo" href="javascript:history.back()">
    <strong>
     BLOG
    </strong>
    space
   </a>
   <!-- <nav class="nav mobile">
                <a href="#menu">Menu</a>
            </nav> -->
   <nav class="nav">
    <ul class="actions">
     <li>
      <a class="scrolly" href="../blog_0.html">
       Home
      </a>
     </li>
     <li>
      <a href="javascript:history.back()">
       Back
      </a>
     </li>
    </ul>
   </nav>
  </header>
  <!-- Nav -->
  <!-- <nav id="menu">
				<ul class="links">
					<li><a href="index.html">Home</a></li>
				</ul>
			</nav> -->
  <!-- Main -->
  <section id="main">
   <div class="inner">
    <header>
     <h1>
      Python's referential transparency
     </h1>
     <p class="info">
      Part 1 - A rant
     </p>
    </header>
    <p>
     Python's Generator functions and expressions introduced lazy evaluation syntax into an previously mostly eagerly evaluated ecosystem. Laziness was first introduced in functional programming languages and that's for a reason. To assure a function can be evaluated at any time, yet yield the same result requires referential transparency.
    </p>
    <p>
     This poses the question: Is there any thing close to referential transparency in Python?
There's not even constants, so an easy shot is to just answer: Nope.
    </p>
    <p>
     Let's look at an example for that. We'll define a pair of functions. One named
     <code>
      f
     </code>
     is a normal Python function;
     <code>
      g
     </code>
     however is a generator function, the lazy equivalent of a normal Python function:
    </p>
    <pre><code class="python">&gt;&gt;&gt; def f(x):
...     return x*x
...
&gt;&gt;&gt; def g(xs):
...     for x in xs:
...         yield f(x)
...
</code></pre>
    <p>
     Let's call
     <code>
      g
     </code>
     and see what happens. Since it is lazy we can easily call it on an infinite structure. Calling it like that also proofs its laziness once and for all.
    </p>
    <pre><code class="python">&gt;&gt;&gt; from itertools import count
&gt;&gt;&gt; gen = g(count())
&gt;&gt;&gt; [next(gen) for _ in range(10)]
[0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
</code></pre>
    <p>
     Defining
     <code>
      gen
     </code>
     does not blow up our computer, so we are indeed not evaluating eagerly. But what happens once we change
     <code>
      f
     </code>
     to be the identity function?
    </p>
    <pre><code class="python">&gt;&gt;&gt; f = lambda x: x
&gt;&gt;&gt; next(gen)
10
</code></pre>
    <h2>
     Now that sucks
    </h2>
    <p>
     There's no referential transparency. Or is there?
Well it comes down to conventionalism. That's the charm of Python I guess.
Let's change our interpretation of a generator function from being the lazy equivalent of a usual function to being the constructor of such an equivalent.
    </p>
    <p>
     As the Zen of Python teaches us:
    </p>
    <blockquote>
     <p>
      Namespaces are one honking great idea -- let's do more of those!
     </p>
    </blockquote>
    <p>
     Let's redefine
     <code>
      g
     </code>
     to create a generator in an confined namespace:
    </p>
    <pre><code class="python">&gt;&gt;&gt; def g(f,xs):
     yield from (f(x) for x in xs)
</code></pre>
    <p>
     For convenience the for-loop expression was substituted with a generator expression. The important difference is the introduction of an inner scoped function
     <code>
      f
     </code>
     . Let's see such a generator in action:
    </p>
    <pre><code class="python">&gt;&gt;&gt; gen = g(f,count())
&gt;&gt;&gt; [next(gen) for _ in range(10)]
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
&gt;&gt;&gt;f = lambda x: x+x
&gt;&gt;&gt;next(gen)
10
</code></pre>
    <p>
     Where has the function
     <code>
      f
     </code>
     gone to though?
     <em>
      Has it amazingly become the first constant ever to be seen in Python?
     </em>
    </p>
    <h3>
     Of course not
    </h3>
    <p>
     The variable state is just localized (good) and harder to access (really not that good):
    </p>
    <pre><code class="python">&gt;&gt;&gt; gen.gi_frame.f_locals
{'xs': count(10), 'f': &lt;function &lt;lambda&gt; at 0x7f82bb3b7710&gt;}
</code></pre>
    <p>
     Here we can also explore a dirty trick Python plays on us to keep us believing in laziness within its realm. The for loop over count has somehow transcended into the count function.
Still as long as we keep ourselves and our users from touching gen's internal state, we can guarante referential transparency now.
    </p>
    <p>
     <strong>
      Python is weird.
     </strong>
    </p>
   </div>
  </section>
  <!-- Footer -->
  <footer id="footer">
   <ul class="icons">
    <li>
     <a class="fab fa-twitter fa-2x" href="https://twitter.com/pIakoIb" style="text-decoration: none">
     </a>
    </li>
    <li>
     <a class="fab fa-researchgate fa-2x" href="https://www.researchgate.net/profile/Simon_Plakolb" style="text-decoration: none">
     </a>
    </li>
    <li>
     <a class="fab fa-github fa-2x" href="https://github.com/pinselimo" style="text-decoration: none">
     </a>
    </li>
   </ul>
   <div class="copyright">
    <i class="fas fa-phone-alt">
     +43 (0)316 380 - 7347
    </i>
    <br/>
    <i class="fas fa-envelope">
     simon (dot) plakolb (at) uni (minus) graz (dot) at
    </i>
    <br/>
    <i class="fas fa-map-marker-alt">
     Merangasse 18, A-8010 Graz
    </i>
    <br/>
    © Simon Plakolb. License:
    <a href="http://creativecommons.org/licenses/by/3.0">
     CC-BY
    </a>
    . Template:
    <a href="https://templated.co">
     TEMPLATED
    </a>
    .
   </div>
  </footer>
  <!-- Scripts -->
  <script src="../../assets/js/jquery.min.js">
  </script>
  <script src="../../assets/js/jquery.scrolly.min.js">
  </script>
  <script src="../../assets/js/skel.min.js">
  </script>
  <script src="../../assets/js/util.js">
  </script>
  <script src="../../assets/js/main.js">
  </script>
 </body>
</html>